<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Room</title>
</head>
<body>
    <h2>Welcome to the Chat Room</h2>
    <div id="chat-box"></div>
    
    <input type="text" id="message" placeholder="Type a message">
    <button onclick="sendMessage()">Send</button>

    <button onclick="logout()">Logout</button>

    <script type="module">
        // Firebase App and Firestore import
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCLsHvtjf4s31KQHRPGiHn95-XQEkiM95Q",
            authDomain: "chat-app-195d0.firebaseapp.com",
            projectId: "chat-app-195d0",
            storageBucket: "chat-app-195d0.appspot.com",
            messagingSenderId: "892853314125",
            appId: "1:892853314125:web:87b3130047c62f81f5f204"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore();
        const chatBox = document.getElementById("chat-box");

        // Check if the user is logged in
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = "index.html"; // Redirect to login page
            }
        });

        // Send message to Firestore
        window.sendMessage = async function() {
            const messageInput = document.getElementById("message");
            const messageText = messageInput.value.trim();

            if (messageText === "") return;

            // Add message to Firestore
            await addDoc(collection(db, "messages"), {
                text: messageText,
                timestamp: new Date(),
                userId: auth.currentUser.uid
            });

            messageInput.value = ""; // Clear input field
        };

        // Listen for new messages in real-time
        const q = query(collection(db, "messages"), orderBy("timestamp", "asc"));
        onSnapshot(q, (snapshot) => {
            chatBox.innerHTML = ""; // Clear chat box
            snapshot.forEach((doc) => {
                const msg = doc.data();
                const messageElement = document.createElement("p");
                messageElement.textContent = msg.text;
                chatBox.appendChild(messageElement);
            });
        });

        // Logout function
        window.logout = function() {
            signOut(auth).then(() => {
                window.location.href = "index.html"; // Redirect to login
            });
        };
    </script>
</body>
</html>
